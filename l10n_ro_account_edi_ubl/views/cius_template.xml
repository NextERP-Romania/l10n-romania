<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="cius_InvoiceType" inherit_id="account_edi_ubl_cii.ubl_20_InvoiceType">
        <xpath expr="//*[local-name()='IssueDate']" position="after">

            <cbc:InvoiceTypeCode
                xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
                xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2"
                t-if="invoice.move_type in ('out_refund', 'in_invoice', 'in_refund')"
                t-att="vals.get('invoice_type_code_attrs', {})"
                t-out="vals.get('invoice_type_code')"
            />
        </xpath>
        <xpath expr="t[@t-foreach='vals.get('invoice_line_vals', [])'" position="after">
            <t t-foreach="vals.get('invoice_line_vals', [])" t-as="foreach_vals">
                <cac:InvoiceLine t-if="invoice.move_type == 'in_invoice'">
                    <t t-call="{{InvoiceLineType_template}}">
                        <t t-set="vals" t-value="foreach_vals"/>
                    </t>
                </cac:InvoiceLine>
                <cac:CreditNoteLine t-if="invoice.move_type == 'in_refund'">
                    <t t-call="{{InvoiceLineType_template}}">
                        <t t-set="vals" t-value="foreach_vals"/>
                    </t>
                </cac:CreditNoteLine>
            </t>
        </xpath>
    </template>
</odoo>
